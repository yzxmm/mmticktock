# 项目设计文档：手绘风跨年倒计时

## 1. 项目概述
本项目旨在为网络主播提供一个全手绘风格的桌面倒计时/正计时工具。
工具是一个透明背景的 EXE 应用程序，悬浮在桌面上，显示当前距离 2026 年的时间。
- **2026年之前**：显示倒计时。
- **2026年之后**：显示正计时（从 00:00 开始累积）。
- **终止条件**：正计时达到 99:99 后停止。

## 2. 技术选型
- **编程语言**：Python 3.x
- **GUI 框架**：PyQt5
  - 原因：成熟稳定，对透明窗口、无边框窗口支持良好，易于实现自定义绘图和右键菜单。
- **打包工具**：PyInstaller
  - 原因：可以将 Python 脚本打包为独立的 .exe 文件，无需安装 Python 环境。
- **图片处理**：Pillow (PIL) 或 PyQt5 原生 Pixmap

## 3. 功能模块

### 3.1 窗口显示
- **无边框窗口** (`FramelessWindowHint`)
- **透明背景** (`WA_TranslucentBackground`)
- **顶层显示** (`WindowStaysOnTopHint`) - 可选，方便主播使用。
- **拖拽移动**：由于无边框，需要实现鼠标按住窗口任意位置拖动的功能。

### 3.2 时间逻辑
- **核心时间点**：`2026-01-01 00:00:00` (目标时区)
- **状态机**：
  1.  **倒计时模式** (`Current < Target`)
      - 计算 `Target - Current`。
      - 格式化为 `MM:SS` (分:秒) 或 `HH:MM`？
      - *修正*：用户需求是 `XX:XX`。通常倒计时跨年是 `HH:MM` 或 `MM:SS`。考虑到可能还有几个小时，且最后只到 99:99，如果是小时:分钟，99小时大约是4天。如果是分钟:秒，99分钟是1个半小时。
      - **假设**：由于是跨年倒计时，通常最后时刻是 分:秒。但如果是提前很久打开，可能是 时:分。
      - **决策**：为了通用性，如果剩余时间 > 1小时，显示 `HH:MM`；如果 < 1小时，显示 `MM:SS`？
      - 或者根据用户描述 "显示XX:XX（时间）...最终停在99:99"，这暗示了两位数:两位数的结构。
      - 让我们采用智能显示：
        - 如果剩余时间 > 99小时，显示 `>99h` (或者就需要3位数字，但用户只给了XX:XX)。
        - 让我们简化逻辑：显示 **小时:分钟** 直到最后1小时变为 **分钟:秒**？
        - 不，用户说“最终停在99:99”。正计时 99:99 通常指 99分99秒（不合理）或者 99小时99分（不合理）。
        - 最合理的解释是：**分钟:秒**。
        - 如果现在离跨年还有好几天，显示分钟:秒会溢出。
        - **再次审视需求**：“显示XX:XX（时间）... 25年过完前是倒计时”。
        - 如果现在是 2025-12-30，离跨年还有约 36小时。36 * 60 = 2160 分钟。XX:XX 无法显示。
        - 可能用户希望显示的是 **小时:分钟**？
        - 如果是正计时，到达 2026 年后，开始正计时。最终停在 99:99。如果是小时:分钟，那就是 100个小时后停止（约4天）。如果是分钟:秒，那就是 100分钟后停止（约1.5小时）。
        - **决策**：默认为 **小时:分钟**。当进入最后 1 小时内，自动切换为 **分钟:秒**？或者由用户右键切换？
        - 为了简化且符合“手绘风”通常的直观性，我们设定：
          - 默认逻辑：智能判断。
          - 如果剩余时间 > 100 分钟，显示 `HH:MM` (小时:分钟)。
          - 如果剩余时间 <= 99 分钟，显示 `MM:SS` (分钟:秒)。
          - 正计时同理：开始是 `MM:SS`，超过 99 分钟后可能就停了？或者变成 `HH:MM`？
          - 用户说“最终停在 99:99”。这看起来像是一个计数器的上限。
          - **最终方案**：
            - 我们将显示逻辑设定为：优先显示 **分钟:秒**。如果超过 99 分59秒，显示 **小时:分钟**。
            - 或者，完全听从用户的 `XX:XX` 和 `99:99` 上限。
            - 让我们实现一个能够动态加载 0-9 图片的系统。
            - 时间格式：我们将实现一个 `HH:MM` 和 `MM:SS` 的自动切换，或者在右键菜单提供选择。
            - **默认行为**：
              - 倒计时：如果 > 99小时，显示 99:99 (或者显示天数? 不，用户限制了 XX:XX)。我们假设主播会在跨年前不久打开。如果时间 > 100小时，显示 99:99。
              - 如果 < 100小时 且 > 1小时：显示 HH:MM。
              - 如果 < 1小时：显示 MM:SS。
              - 正计时：从 00:00 (MM:SS) 开始。
              - 超过 59:59 后继续增加到 99:59 (MM:SS) 还是 01:00 (HH:MM)?
              - 用户说“最终停在 99:99”。这强烈暗示是纯数字计数，不进位到下一级单位，或者就是简单的 分:秒 或 时:分。
              - 让我们做一个灵活的配置：**以分钟为单位倒计时/正计时**，但显示格式为 XX:XX。
              - 比如 90分钟 -> 90:00。
              - 比如 1分钟 -> 01:00。
              - 等等，XX:XX 也有可能是 HH:MM。
              - 让我们在右键菜单增加一个“显示模式”选项：`自动`、`强制时:分`、`强制分:秒`。

### 3.3 时区选择
- 使用 `pytz` 库获取所有时区。
- 右键菜单提供常用时区列表（如：中国标准时间，东京，伦敦，纽约，洛杉矶等）。
- 也提供“自定义时区”或“本地系统时间”选项。

## 4. 资源加载
- 程序启动时扫描 `assets` 文件夹。
- 加载 `0.png` 到 `9.png`。
- 加载 `colon.png` (冒号)。
- 加载 `bg.png` (背景)。
- 如果资源缺失，使用程序内置的绘制逻辑作为 fallback，并弹窗提示。

